<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Push Notification Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.0.2/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/DOMPurify/2.3.3/purify.min.js"></script>
    <style>
        body {
            font-family: "Microsoft YaHei", -apple-system, BlinkMacSystemFont, sans-serif;
        }
        .input-group {
            margin-bottom: 1.5rem;
        }
        .input-label {
            margin-bottom: 0.75rem;
            font-size: 0.95rem;
            font-weight: 500;
            color: #374151;
        }
        .input-field {
            line-height: 1.6;
            padding: 0.75rem 1rem;
            transition: all 0.2s ease;
        }
        .section-container {
            padding: 2rem;
            margin-bottom: 2rem;
            background-color: #f9fafb;
            border-radius: 1rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 1.5rem;
        }
        .button-spacing {
            margin: 0.5rem;
        }
        .json-output {
            font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
            line-height: 1.6;
            padding: 1.5rem;
        }
        .action-button {
            padding: 1rem 2rem;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 1rem;
            transition: all 0.2s ease;
            min-width: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        .markdown-preview {
            background: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            border: 1px solid #e5e7eb;
        }
        .markdown-preview h1 { font-size: 1.5em; font-weight: bold; margin: 1em 0; }
        .markdown-preview h2 { font-size: 1.3em; font-weight: bold; margin: 0.8em 0; }
        .markdown-preview h3 { font-size: 1.1em; font-weight: bold; margin: 0.6em 0; }
        .markdown-preview p { margin: 1em 0; }
        .markdown-preview ul { list-style-type: disc; padding-left: 2em; margin: 1em 0; }
        .markdown-preview ol { list-style-type: decimal; padding-left: 2em; margin: 1em 0; }
        .markdown-preview code { background: #f3f4f6; padding: 0.2em 0.4em; border-radius: 0.2em; }
        .markdown-preview pre { background: #f3f4f6; padding: 1em; border-radius: 0.5em; overflow-x: auto; }
        .markdown-preview blockquote { border-left: 4px solid #e5e7eb; padding-left: 1em; margin: 1em 0; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen py-12">
    <div class="max-w-6xl mx-auto px-8">
        <div class="bg-white rounded-xl shadow-lg p-10 space-y-8">
            <!-- Header -->
            <div class="mb-12">
                <h1 class="text-4xl font-bold text-gray-800 mb-4">Push Notification Generator</h1>
                <p class="text-gray-600 text-lg">Configure your template and generate JSON push notifications</p>
                <p class="mt-4 text-amber-600 flex items-center gap-2 text-lg">
                    <span>ðŸ’¡</span> This is for internal use only.
                </p>
            </div>

            <!-- Template Configuration -->
            <div class="section-container bg-blue-50">
                <h2 class="section-title text-blue-800">Template Configuration</h2>
                <form id="templateForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="input-group">
                        <label class="input-label">Platform</label>
                        <input type="text" id="templatePlatform" value="all" 
                            class="input-field w-full rounded-lg border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200">
                    </div>
                    <div class="input-group">
                        <label class="input-label">Version</label>
                        <input type="text" id="templateVersion" value="1.0.8,1.0.9,1.1.0,1.1.1"
                            class="input-field w-full rounded-lg border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200">
                    </div>
                    <div class="input-group">
                        <label class="input-label">Type ID</label>
                        <input type="number" id="templateTypeId" value="2"
                            class="input-field w-full rounded-lg border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200">
                    </div>
                    <div class="input-group">
                        <label class="input-label">Device IDs</label>
                        <input type="text" id="templateDeviceIds" value="19edc84e92b066ba,A8F06E2E-F072-48B8-A532-F54FCDC02454"
                            class="input-field w-full rounded-lg border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200">
                    </div>
                    <div class="input-group">
                        <label class="input-label">Answer Type</label>
                        <input type="text" id="templateAnswerType" value="web_search"
                            class="input-field w-full rounded-lg border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200">
                    </div>
                </form>
            </div>

            <!-- Push Title and Message Section -->
            <div class="section-container bg-blue-50">
                <h2 class="section-title text-blue-800">Push Content</h2>
                <form id="notificationForm" class="space-y-8">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="input-group">
                            <label class="input-label">Push Title</label>
                            <input type="text" id="pushTitle" 
                                class="input-field w-full rounded-lg border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200" required>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Push Message</label>
                            <input type="text" id="pushMessage" 
                                class="input-field w-full rounded-lg border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200" required>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Guess Questions -->
            <div class="section-container bg-blue-50">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="section-title text-blue-800">Guess Questions</h3>
                    <button type="button" onclick="addQuestion()" 
                        class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg transition-colors duration-200 flex items-center">
                        <span class="mr-2">+</span> Add Question
                    </button>
                </div>
                <div id="questionsContainer" class="space-y-4"></div>
            </div>

            <!-- URLs -->
            <div class="section-container bg-blue-50">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="section-title text-blue-800">URLs</h3>
                    <button type="button" onclick="addUrl()" 
                        class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg transition-colors duration-200 flex items-center">
                        <span class="mr-2">+</span> Add URL
                    </button>
                </div>
                <div id="urlsContainer" class="space-y-4"></div>
            </div>

            <!-- Body Content -->
            <div class="section-container bg-blue-50">
    <h3 class="section-title text-blue-800">Body Content</h3>
    <div class="flex flex-col space-y-4">
        <div class="flex justify-between items-center">
            <label class="text-sm font-medium text-gray-600">Markdown Editor</label>
            <div class="space-x-2">
                <button onclick="insertMarkdown('**')" class="px-2 py-1 bg-gray-200 rounded hover:bg-gray-300" title="Bold">B</button>
                <button onclick="insertMarkdown('*')" class="px-2 py-1 bg-gray-200 rounded hover:bg-gray-300 italic" title="Italic">I</button>
                <button onclick="insertMarkdown('`')" class="px-2 py-1 bg-gray-200 rounded hover:bg-gray-300 font-mono" title="Code">{}</button>
                <button onclick="insertMarkdown('> ')" class="px-2 py-1 bg-gray-200 rounded hover:bg-gray-300" title="Quote">â€³</button>
            </div>
        </div>
        <textarea id="bodyContent" rows="6" 
            class="input-field w-full rounded-lg border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200"
            oninput="updatePreview()"></textarea>
        <div class="flex justify-between items-center">
            <label class="text-sm font-medium text-gray-600">Preview</label>
            <span class="text-sm text-gray-500" id="charCount">0 characters</span>
        </div>
        <div id="markdownPreview" class="markdown-preview"></div>
    </div>
</div>

            <!-- Output Section -->
            <div class="section-container bg-blue-50">
    <div class="flex justify-between items-center mb-6">
        <h3 class="section-title text-blue-800">Generated JSON</h3>
        <div class="flex items-center space-x-6">
            <button type="submit" form="notificationForm"
                class="action-button bg-blue-600 hover:bg-blue-700 text-white shadow-lg hover:shadow-xl">
                <span>ðŸ”„</span> Generate JSON
            </button>
            <button onclick="copyToClipboard()" 
                class="action-button bg-gray-600 hover:bg-gray-700 text-white shadow-lg hover:shadow-xl">
                <span>ðŸ“‹</span> Copy to Clipboard
            </button>
        </div>
    </div>
    <div class="relative">
        <textarea id="jsonOutput" rows="12" 
            class="json-output w-full rounded-lg border-gray-300 bg-white focus:border-blue-500 focus:ring-2 focus:ring-blue-200" 
            readonly></textarea>
    </div>
</div>

    <script>
        function addQuestion() {
            const container = document.getElementById('questionsContainer');
            const div = document.createElement('div');
            div.className = 'flex gap-4';
            div.innerHTML = `
                <input type="text" class="question-input input-field flex-grow rounded-lg border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200">
                <button type="button" onclick="removeQuestion(this)" 
                    class="bg-red-500 hover:bg-red-600 text-white px-6 rounded-lg transition-colors duration-200">Ã—</button>
            `;
            container.appendChild(div);
        }

        function removeQuestion(button) {
            button.parentElement.remove();
        }

        function addUrl() {
            const container = document.getElementById('urlsContainer');
            const div = document.createElement('div');
            div.className = 'flex gap-4';
            div.innerHTML = `
                <input type="text" class="url-input input-field flex-grow rounded-lg border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200">
                <button type="button" onclick="removeUrl(this)" 
                    class="bg-red-500 hover:bg-red-600 text-white px-6 rounded-lg transition-colors duration-200">Ã—</button>
            `;
            container.appendChild(div);
        }

        function removeUrl(button) {
            button.parentElement.remove();
        }

        function copyToClipboard() {
            const jsonOutput = document.getElementById('jsonOutput');
            jsonOutput.select();
            document.execCommand('copy');
            
            const button = document.querySelector('button[onclick="copyToClipboard()"]');
            const originalText = button.innerHTML;
            button.innerHTML = '<span>âœ“</span> Copied!';
            setTimeout(() => {
                button.innerHTML = originalText;
            }, 2000);
        }

        document.getElementById('notificationForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const templateConfig = {
                platform: document.getElementById('templatePlatform').value,
                version: document.getElementById('templateVersion').value,
                type_id: parseInt(document.getElementById('templateTypeId').value),
                device_ids: document.getElementById('templateDeviceIds').value,
                answer_type: document.getElementById('templateAnswerType').value
            };

            const title = document.getElementById('pushTitle').value;
            const message = document.getElementById('pushMessage').value;
            const body = document.getElementById('bodyContent').value;

            const questions = Array.from(document.getElementsByClassName('question-input'))
                .map(input => input.value)
                .filter(q => q.trim() !== '');

            const urls = Array.from(document.getElementsByClassName('url-input'))
                .map(input => ({
                    url: input.value,
                    title: "Title placeholder",
                    snippet: "Snippet placeholder"
                }))
                .filter(url => url.url.trim() !== '');

            const data = {
                platform: templateConfig.platform,
                version: templateConfig.version,
                type_id: templateConfig.type_id,
                device_ids: templateConfig.device_ids,
                title: title,
                message: message,
                extend: {
                    guess_question: questions,
                    reply: {
                        answer_type: templateConfig.answer_type,
                        data: {
                            header: urls.map(url => ({
                                url: url.url,
                                title: url.title,
                                passage_or_snippet: url.snippet
                            })),
                            body: body
                        }
                    }
                }
            };

            document.getElementById('jsonOutput').value = JSON.stringify(data, null, 2);
        });

        // Add initial question and URL fields
        addQuestion();
        addUrl();

     marked.setOptions({
        breaks: true,
        gfm: true
    });

    function updatePreview() {
        const input = document.getElementById('bodyContent');
        const preview = document.getElementById('markdownPreview');
        const charCount = document.getElementById('charCount');
        
        // Convert line breaks to \n\n for the actual content
        const processedContent = input.value.replace(/\n/g, '\n\n');
        input.dataset.processedContent = processedContent;
        
        // Update preview
        const renderedHtml = marked(input.value);
        preview.innerHTML = DOMPurify.sanitize(renderedHtml);
        
        // Update character count
        charCount.textContent = `${input.value.length} characters`;
    }

    function insertMarkdown(markup) {
        const textarea = document.getElementById('bodyContent');
        const start = textarea.selectionStart;
        const end = textarea.selectionEnd;
        const text = textarea.value;
        
        if (markup === '> ') {
            // For blockquotes, add at start of line
            const beforeSelection = text.substr(0, start);
            const selection = text.substr(start, end - start);
            const afterSelection = text.substr(end);
            const lineStart = beforeSelection.lastIndexOf('\n') + 1;
            
            textarea.value = text.substr(0, lineStart) + markup + text.substr(lineStart);
        } else {
            // For other markup, wrap selected text
            const selected = text.substr(start, end - start);
            textarea.value = text.substr(0, start) + markup + selected + markup + text.substr(end);
        }
        
        updatePreview();
        textarea.focus();
    }

    // Modify the existing form submit handler to use the processed content
    document.getElementById('notificationForm').addEventListener('submit', function(e) {
        e.preventDefault();

        // ... (previous code remains the same until body assignment)
        
        const bodyContent = document.getElementById('bodyContent');
        const body = bodyContent.dataset.processedContent || bodyContent.value.replace(/\n/g, '\n\n');

        // ... (rest of the code remains the same)
    });

    // Initialize preview
    updatePreview();   
    </script>
</body>
</html>
